SHELL := /bin/bash

GIVER_ADDRESS=
PUBLIC_KEY=
KEY=

CONFIGS_PATH=
KEYS_PATH=
CONTRACTS_PATH=
SCRIPTS_PATH=

BRIDGE_VOTE_CONTROLLER_PUBLIC_KEY=
PROPOSAL_VOTERS_AMOUNT=

TON_URL=

INI_VALUE=

ROOT_TOKEN_CONTRACT_ADDRESS=
ROOT_TOKEN_CONTRACT_PARAMS=

TON_TOKEN_WALLET_ADDRESS=
TON_TOKEN_WALLET_PARAMS=

TIP3_HANDLER_ADDRESS=
TIP3_HANDLER_PARAMS=

RELAYER_ADDRESS=
RELAYER_PARAMS=

SENDER_ADDRESS=
RECEIVER_ADDRESS=

ACCESS_CONTROLLER_ADDRESS=
ACCESS_CONTROLLER_PARAMS=

BRIDGE_VOTE_CONTROLLER_ADDRESS=
BRIDGE_VOTE_CONTROLLER_PARAMS=

BRIDGE_ADDRESS=
BRIDGE_PARAMS=

MSG_HANDLER_ADDRESS=
MSG_HANDLER_PARAMS=

BLOCK_TIME=

PROPOSAL_CODE="te6ccgECGQEABToAAib/APSkICLAAZL0oOGK7VNYMPShBQEBCvSkIPShAgIDzsAEAwBn12omhp/+mf6YBq64X//Dfpg+mf/SBqaf/6AnoC/Dj8OHw3fDb8Nnw1/DU//DD8M3wx/DFABt98IWRl//wh54Wf/CNnhYBkfCeA5f/8JXwl/CZ8JvwnfCh8KK84Z4jlg+Wf52Zl//oAegBk9qpAIBIAkGAcb/f40IYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABPhpIe1E0CDXScIBjjDT/9M/0wDV1wv/+G/TB9M/+kDU0//0BPQF+HH4cPhu+G34bPhr+Gp/+GH4Zvhj+GIHAf6OffQFcSGAQPQOk9cLB5Fw4vhqciGAQPQOk9cLP5Fw4vhrcyGAQPQOjiSNCGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATf+Gx0IYBA9A+SyMnf+G1w+G5w+G9t+HBt+HFwAYBA9A7yvdcL//hicPhjcPhmf/hhCACu4tMAAZ+BAgDXGCD5AVj4QvkQ8qje0z8Bjh74QyG5IJ8wIPgjgQPoqIIIG3dAoLnekvhj4IA08jTY0x8hwQMighD////9vLGTW/I84AHwAfhHbpMw8jzeAgEgEQoCASAMCwCZu9omiG+EFukvAE3tFwcPhQePQOk9cL/5Fw4jEhwP+OIyPQ0wH6QDAxyM+HIM6AYM9Az4HPgc+T9omiGiHPC//JcfsA3jCS8APef/hngCAUgODQCZt2Xk+n4QW6S8ATe0XBx+FB49A6T1wv/kXDiMSHA/44jI9DTAfpAMDHIz4cgzoBgz0DPgc+Bz5M2Xk+mIc8L/8lx+wDeMJLwA95/+GeABCbY8A8OgDwH++EFukvAE3vpA0wfXDf+V1NHQ0//f+kGV1NHQ+kDf0fhJ+EzHBfLgZCP4UYEBC/QKIJEx3rPy4GT4UCMBUxB49A6T1wv/kXDipMjL/1l49EP4cPhRJAEkyMsHWYEBC/RB+HFx+FB49A6T1wv/kXDicPhQePQOk9cL/5Fw4qD4TxAAqL6OSSBwyM+FgMoAc89Azo0EUC+vCAAAAAAAAAAAAAAAAAABzxbPgc+DyM+QoQtcYvhCzwv/+ErPCwf4S88LPyPPC//4Tc8Uzclx+wDeXwTwA3/4ZwIBIBgSAQ+76f5+/4QW6BMC5I6A3vhG8nNx+GbT/9cN/5XU0dDT/9/XDQeV1NHQ0wff+kGV1NHQ+kDf+kGV1NHQ+kDf1w3/ldTR0NP/39H4ACX4biT4b/hQJAFTEHj0DpPXC/+RcOKkyMv/WXj0Q/hw+FEjASXIywdZgQEL9EH4cSTAARUUAKaOSSFwyM+FgMoAc89Azo0EUC+vCAAAAAAAAAAAAAAAAAABzxbPgc+DyM+QoQtcYvhCzwv/+ErPCwf4S88LPyLPC//4Tc8Uzclx+wDeXwbwA3/4ZwF07UTQINdJwgGOMNP/0z/TANXXC//4b9MH0z/6QNTT//QE9AX4cfhw+G74bfhs+Gv4an/4Yfhm+GP4YhYB/o599AVxIYBA9A6T1wsHkXDi+GpyIYBA9A6T1ws/kXDi+GtzIYBA9A6OJI0IYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABN/4bHQhgED0D5LIyd/4bXD4bnD4b234cG34cXABgED0DvK91wv/+GJw+GNw+GZ/+GEXAALiAGjdcCLQ0wP6QDD4aak4ANwhxwDcIdMfId0hwQMighD////9vLGTW/I84AHwAfhHbpMw8jze"

WALLET_CODE="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"

.PHONY: init
init:
	tonos-cli config --url $(TON_URL)
	$(MAKE) -f $(SCRIPTS_PATH)/Makefile ton-init
	$(MAKE) -f $(SCRIPTS_PATH)/Makefile ton-deploy-contracts
	$(MAKE) -f $(SCRIPTS_PATH)/Makefile sub-setup
	$(MAKE) -f $(SCRIPTS_PATH)/Makefile ton-block-producing

# $(call ton_send_init_value,$(TON_TOKEN_WALLET_ADDRESS),$(INI_VALUE))
# $(eval TON_TOKEN_WALLET_PARAMS := '{"_proposalStateInit":"'$(shell base64 -w 0 $(CONTRACTS_PATH)/Proposal.tvc)'"}')
# $(call ton_deploy,TONTokenWallet,$(TON_TOKEN_WALLET_PARAMS))

.PHONY: ton-init
ton-init:
	$(call ton_set_addresses)

	$(call ton_send_init_value,$(RELAYER_ADDRESS),$(INI_VALUE))
	$(call ton_send_init_value,$(SENDER_ADDRESS),$(INI_VALUE))
	$(call ton_send_init_value,$(RECEIVER_ADDRESS),$(INI_VALUE))
	$(call ton_send_init_value,$(BRIDGE_VOTE_CONTROLLER_ADDRESS),$(INI_VALUE))
	$(call ton_send_init_value,$(ACCESS_CONTROLLER_ADDRESS),$(INI_VALUE))
	$(call ton_send_init_value,$(BRIDGE_ADDRESS),$(INI_VALUE))
	$(call ton_send_init_value,$(MSG_HANDLER_ADDRESS),$(INI_VALUE))
	$(call ton_send_init_value,$(ROOT_TOKEN_CONTRACT_ADDRESS),$(INI_VALUE))
	$(call ton_send_init_value,$(TIP3_HANDLER_ADDRESS),$(INI_VALUE))

.PHONY: ton-deploy-contracts
ton-deploy-contracts:
	$(call ton_set_addresses)

	$(eval RELAYER_PARAMS := '{"_accessControllerAddress": "$(ACCESS_CONTROLLER_ADDRESS)", "_myPublicKey": "$(PUBLIC_KEY)", "_myInitState":"$(shell base64 -w 0 $(CONTRACTS_PATH)/Relayer.tvc)", "_bridgeAddress":"$(BRIDGE_ADDRESS)"}')
	$(eval BRIDGE_VOTE_CONTROLLER_PARAMS := '{"_proposalCode":"'$(PROPOSAL_CODE)'", "_deployInitialValue": 2000000000,"_publicKey":"$(PUBLIC_KEY)","_proposalPublicKey":"$(PUBLIC_KEY)","_proposalVotersAmount":$(PROPOSAL_VOTERS_AMOUNT),"_bridgeAddress":"$(BRIDGE_ADDRESS)"}')
	$(eval BRIDGE_PARAMS := '{"_relayerInitState":"$(shell base64 -w 0 $(CONTRACTS_PATH)/Relayer.tvc)","_accessControllerAddress":"$(ACCESS_CONTROLLER_ADDRESS)","_voteControllerAddress": "$(BRIDGE_VOTE_CONTROLLER_ADDRESS)"}')
	$(eval ACCESS_CONTROLLER_PARAMS := '{"_accessCardInitState":"$(shell base64 -w 0 $(CONTRACTS_PATH)/Relayer.tvc)", "_initialValue": 1000000}')
	$(eval MSG_HANDLER_PARAMS := '{"_proposalCode":"'$(PROPOSAL_CODE)'","_bridgeVoteControllerAddress":"$(BRIDGE_VOTE_CONTROLLER_ADDRESS)","_bridgeVoteControllerPubKey":"$(PUBLIC_KEY)"}')
	$(eval TIP3_HANDLER_PARAMS := '{"_proposalCode":"'$(PROPOSAL_CODE)'","_bridgeVoteControllerAddress":"$(BRIDGE_VOTE_CONTROLLER_ADDRESS)","_bridgeVoteControllerPubKey":"$(PUBLIC_KEY)","_tip3RootAddress":"$(ROOT_TOKEN_CONTRACT_ADDRESS)"}')
	$(eval ROOT_TOKEN_CONTRACT_PARAMS := '{"name":"$(shell echo DOTON | xxd -p)","symbol":"$(shell echo DTN | xxd -p)", "decimals":"0x10","root_public_key":"0x0", "root_owner":"0xdf22eba0b48020b70efa7a6e9d6360ed1dc20877250947470cc1289b14c9cc1e", "wallet_code":"'$(WALLET_CODE)'","total_supply":"0x38d7ea4c68000"}')

	$(call ton_deploy,Sender,{})
	$(call ton_deploy,Receiver,{})
	$(call ton_deploy,AccessController,$(ACCESS_CONTROLLER_PARAMS))
	$(call ton_deploy,BridgeVoteController,$(BRIDGE_VOTE_CONTROLLER_PARAMS))
	$(call ton_deploy,Bridge,$(BRIDGE_PARAMS))
	$(call ton_deploy,Relayer,$(RELAYER_PARAMS))
	$(call ton_deploy,RootTokenContract,$(ROOT_TOKEN_CONTRACT_PARAMS))
	$(call ton_deploy,Tip3Handler,$(TIP3_HANDLER_PARAMS))
	$(call ton_deploy,MessageHandler,$(MSG_HANDLER_PARAMS))

	tonos-cli call $(ACCESS_CONTROLLER_ADDRESS) grantSuperAdminRole '{"accessCardAddress": "$(RELAYER_ADDRESS)"}' --abi $(CONTRACTS_PATH)/AccessController.abi.json --sign $(KEYS_PATH)/$(KEY).tonos.key
	tonos-cli call $(RELAYER_ADDRESS) bridgeSetHandler '{"messageType": "0x000000000000000000000053696d706c654d6573736167655265736f75726365", "handlerAddress":"$(MSG_HANDLER_ADDRESS)"}' --abi $(CONTRACTS_PATH)/Relayer.abi.json --sign $(KEYS_PATH)/$(KEY).tonos.key
	tonos-cli call $(RELAYER_ADDRESS) bridgeSetHandler '{"messageType": "0x000000000000000000000000000000c76ebe4a02bbc34786d860b355f5a5ce00", "handlerAddress":"$(TIP3_HANDLER_ADDRESS)"}' --abi $(CONTRACTS_PATH)/Relayer.abi.json --sign $(KEYS_PATH)/$(KEY).tonos.key

.PHONY: ton-block-producing
ton-block-producing:
	$(call ton_set_addresses)
	while [ 1 -gt 0 ] ; do \
		tonos-cli callex sendGrams $(GIVER_ADDRESS) $(CONTRACTS_PATH)/Giver.abi.json -- --dest $(RELAYER_ADDRESS) --amount "0" \
		sleep $(BLOCK_TIME); \
	done

.PHONY: sub-setup
sub-setup:
	halva-cli exec -f $(SCRIPTS_PATH)/setup.js -p $(CONFIGS_PATH)/halva.js

.PHONY: ton-send-msg
ton-send-msg:
	$(call ton_set_addresses)
	tonos-cli call $(SENDER_ADDRESS) sendData '{"destination": "'$(RECEIVER_ADDRESS)'", "bounce":true, "value": "20000000", "data":"0x$(shell echo $(MSG) | xxd -p)", "destinationChainId":"0x01"}' --abi $(CONTRACTS_PATH)/Sender.abi.json --sign $(KEYS_PATH)/$(KEY).tonos.key

#################
# TON Functions #
#################

define ton_set_addresses
	$(call ton_genaddr,RELAYER_ADDRESS,Relayer,$(KEY))
	$(call ton_genaddr,SENDER_ADDRESS,Sender,$(KEY))
	$(call ton_genaddr,RECEIVER_ADDRESS,Receiver,$(KEY))
	$(call ton_genaddr,ACCESS_CONTROLLER_ADDRESS,AccessController,$(KEY))
	$(call ton_genaddr,BRIDGE_VOTE_CONTROLLER_ADDRESS,BridgeVoteController,$(KEY))
	$(call ton_genaddr,BRIDGE_ADDRESS,Bridge,$(KEY))
	$(call ton_genaddr,MSG_HANDLER_ADDRESS,MessageHandler,$(KEY))
	$(call ton_genaddr,ROOT_TOKEN_CONTRACT_ADDRESS,RootTokenContract,$(KEY))
	$(call ton_genaddr,TON_TOKEN_WALLET_ADDRESS,TONTokenWallet,$(KEY))
	$(call ton_genaddr,TIP3_HANDLER_ADDRESS,Tip3Handler,$(KEY))

	@echo "Relayer address:                  $(RELAYER_ADDRESS)"
	@echo "Sender address:                   $(SENDER_ADDRESS)"
	@echo "Receiver address:                 $(RECEIVER_ADDRESS)"
	@echo "Access Controller address:        $(ACCESS_CONTROLLER_ADDRESS)"
	@echo "Bridge Vote Controller address:   $(BRIDGE_VOTE_CONTROLLER_ADDRESS)"
	@echo "Bridge address:                   $(BRIDGE_ADDRESS)"
	@echo "Message Handler address:          $(MSG_HANDLER_ADDRESS)"
	@echo "Root Token address:               $(ROOT_TOKEN_CONTRACT_ADDRESS)"
	@echo "Ton Token wallet address:         $(TON_TOKEN_WALLET_ADDRESS)"
	@echo "Tip3 Handler address:             $(TIP3_HANDLER_ADDRESS)"
endef

define ton_genaddr
	$(eval GEN_ADDRESS_CMD :=$(shell tonos-cli genaddr --setkey $(KEYS_PATH)/$(3).tonos.key $(CONTRACTS_PATH)/$(2).tvc $(CONTRACTS_PATH)/$(2).abi.json))
	$(eval $(1) := $(shell echo "$(GEN_ADDRESS_CMD)" | grep -o "Raw address: \([0-9a-zA-Z:]*\)" | grep -o "0:\([0-9a-zA-Z:]*\)"))
endef

define ton_send_init_value
	tonos-cli callex sendGrams $(GIVER_ADDRESS) $(CONTRACTS_PATH)/Giver.abi.json -- --dest $(1) --amount $(2)
endef

define ton_deploy
	tonos-cli deploy $(CONTRACTS_PATH)/$(1).tvc $(2) --abi $(CONTRACTS_PATH)/$(1).abi.json --sign $(KEYS_PATH)/$(KEY).tonos.key
endef
